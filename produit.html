<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Produit - VisuPrint Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap');
        * { font-family: 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif; }
        .btn-primary { background: #e63946; transition: all 0.2s ease; }
        .btn-primary:hover { background: #d62839; }
        .btn-secondary { background: #2b2d42; transition: all 0.2s ease; }
        .btn-secondary:hover { background: #1a1b2e; }
        .nav-link { position: relative; }
        .nav-link:after { content: ''; position: absolute; bottom: -2px; left: 0; width: 0; height: 2px; background: #e63946; transition: width 0.2s ease; }
        .nav-link:hover:after { width: 100%; }
        .cart-badge { position: absolute; top: -8px; right: -8px; background: #e63946; color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 11px; font-weight: 700; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        function getCart() {
            try { return JSON.parse(localStorage.getItem('visuprint_cart') || '[]'); }
            catch { return []; }
        }

        function Header({ cartCount }) {
            return (
                <header className="bg-white border-b border-gray-200 sticky top-0 z-50">
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="flex items-center justify-between h-16">
                            <div className="flex items-center">
                                <div className="flex-shrink-0">
                                    <a href="/"><span className="text-2xl font-black text-gray-900">VisuPrint</span><span className="text-2xl font-black text-red-600">Pro</span></a>
                                </div>
                                <nav className="hidden md:ml-10 md:flex md:space-x-8">
                                    <a href="/" className="nav-link text-gray-700 hover:text-gray-900 px-3 py-2 text-sm font-medium">Accueil</a>
                                    <a href="/catalogue.html" className="nav-link text-gray-700 hover:text-gray-900 px-3 py-2 text-sm font-medium">Catalogue</a>
                                    <a href="/mon-compte.php" className="nav-link text-gray-700 hover:text-gray-900 px-3 py-2 text-sm font-medium">Mon compte</a>
                                </nav>
                            </div>
                            <div className="flex items-center space-x-4">
                                <div className="hidden md:block text-right">
                                    <div className="text-xs text-gray-500">Service client</div>
                                    <div className="text-sm font-bold text-gray-900">01 23 45 67 89</div>
                                </div>
                                <a href="/panier.html" className="relative btn-secondary text-white px-4 py-2 rounded text-sm font-semibold">
                                    üõí Panier{cartCount > 0 && <span className="cart-badge">{cartCount}</span>}
                                </a>
                            </div>
                        </div>
                    </div>
                </header>
            );
        }

        function App() {
            const [product, setProduct] = useState(null);
            const [loading, setLoading] = useState(true);
            const [config, setConfig] = useState({ width: 100, height: 100, quantity: 1, printSide: 'simple', hasEyelets: false, hasCutting: false, hasLamination: false });
            const [cartCount, setCartCount] = useState(0);

            useEffect(() => {
                const params = new URLSearchParams(window.location.search);
                const code = params.get('code');
                if (code) {
                    fetch(`/api/produits.php?code=${code}`)
                        .then(res => res.json())
                        .then(data => { setProduct(data.produit); setLoading(false); })
                        .catch(() => setLoading(false));
                }
                setCartCount(getCart().length);
            }, []);

            const surface = (config.width * config.height) / 10000;
            const totalSurface = surface * config.quantity;

            let pricePerM2 = 0;
            if (product) {
                if (totalSurface > 300) pricePerM2 = parseFloat(product.prix_300_plus);
                else if (totalSurface > 100) pricePerM2 = parseFloat(product.prix_101_300);
                else if (totalSurface > 50) pricePerM2 = parseFloat(product.prix_51_100);
                else if (totalSurface > 10) pricePerM2 = parseFloat(product.prix_11_50);
                else pricePerM2 = parseFloat(product.prix_0_10);
            }

            let totalPrice = surface * pricePerM2 * config.quantity;
            if (config.printSide === 'double') totalPrice *= 1.3;
            if (config.hasEyelets) totalPrice += surface * 2 * config.quantity;
            if (config.hasCutting) totalPrice += surface * 1.5 * config.quantity;
            if (config.hasLamination) totalPrice += surface * 5 * config.quantity;

            const addToCart = () => {
                const cart = getCart();
                cart.push({ name: product.nom, code: product.code_produit, surface, width: config.width, height: config.height, quantity: config.quantity, printSide: config.printSide, hasEyelets: config.hasEyelets, hasCutting: config.hasCutting, hasLamination: config.hasLamination, price: totalPrice });
                localStorage.setItem('visuprint_cart', JSON.stringify(cart));
                window.location.href = '/panier.html';
            };

            if (loading) return <div className="min-h-screen bg-gray-50 flex items-center justify-center"><div className="text-center"><div className="text-6xl mb-4">üì¶</div><h2 className="text-2xl font-bold text-gray-900">Chargement...</h2></div></div>;
            if (!product) return <div className="min-h-screen bg-gray-50 flex items-center justify-center"><div className="text-center"><h2 className="text-2xl font-bold text-gray-900">Produit introuvable</h2><a href="/catalogue.html" className="btn-primary text-white px-6 py-3 rounded mt-4 inline-block">Retour au catalogue</a></div></div>;

            return (
                <div className="min-h-screen bg-gray-50">
                    <Header cartCount={cartCount} />
                    <section className="py-12">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <a href="/catalogue.html" className="text-red-600 hover:text-red-800 mb-6 inline-block">‚Üê Retour au catalogue</a>
                            <div className="grid lg:grid-cols-2 gap-12">
                                <div><div className="bg-gradient-to-br from-gray-800 to-gray-900 h-96 rounded-lg flex items-center justify-center text-8xl">üìã</div></div>
                                <div>
                                    <h1 className="text-3xl font-black text-gray-900 mb-2">{product.nom}</h1>
                                    <p className="text-gray-600 mb-6">{product.description_courte}</p>
                                    <div className="bg-white rounded-lg p-6 border border-gray-200 mb-6">
                                        <h3 className="font-bold text-gray-900 mb-4">Configuration</h3>
                                        <div className="grid grid-cols-2 gap-4 mb-4">
                                            <div><label className="block text-sm font-semibold text-gray-700 mb-2">Largeur (cm)</label><input type="number" value={config.width} onChange={(e) => setConfig({...config, width: parseFloat(e.target.value) || 0})} className="w-full px-4 py-3 border border-gray-300 rounded focus:ring-2 focus:ring-red-600 focus:border-transparent" min="1" /></div>
                                            <div><label className="block text-sm font-semibold text-gray-700 mb-2">Hauteur (cm)</label><input type="number" value={config.height} onChange={(e) => setConfig({...config, height: parseFloat(e.target.value) || 0})} className="w-full px-4 py-3 border border-gray-300 rounded focus:ring-2 focus:ring-red-600 focus:border-transparent" min="1" /></div>
                                        </div>
                                        <div className="mb-4 p-3 bg-gray-50 rounded text-center"><span className="text-sm text-gray-600">Surface: </span><span className="text-xl font-black text-red-600">{surface.toFixed(3)} m¬≤</span></div>
                                        <div className="mb-4"><label className="block text-sm font-semibold text-gray-700 mb-2">Quantit√©</label><input type="number" value={config.quantity} onChange={(e) => setConfig({...config, quantity: parseInt(e.target.value) || 1})} className="w-full px-4 py-3 border border-gray-300 rounded focus:ring-2 focus:ring-red-600 focus:border-transparent" min="1" /></div>
                                        <div className="mb-4"><label className="block text-sm font-semibold text-gray-700 mb-2">Impression</label><select value={config.printSide} onChange={(e) => setConfig({...config, printSide: e.target.value})} className="w-full px-4 py-3 border border-gray-300 rounded focus:ring-2 focus:ring-red-600 focus:border-transparent"><option value="simple">Simple face</option><option value="double">Double face (+30%)</option></select></div>
                                        <h4 className="font-bold text-gray-900 mb-3">Options</h4>
                                        <div className="space-y-2 mb-6">
                                            <label className="flex items-center gap-3 cursor-pointer"><input type="checkbox" checked={config.hasEyelets} onChange={(e) => setConfig({...config, hasEyelets: e.target.checked})} className="w-5 h-5" /><span>≈íillets (+2‚Ç¨/m¬≤)</span></label>
                                            <label className="flex items-center gap-3 cursor-pointer"><input type="checkbox" checked={config.hasCutting} onChange={(e) => setConfig({...config, hasCutting: e.target.checked})} className="w-5 h-5" /><span>D√©coupe (+1.5‚Ç¨/m¬≤)</span></label>
                                            <label className="flex items-center gap-3 cursor-pointer"><input type="checkbox" checked={config.hasLamination} onChange={(e) => setConfig({...config, hasLamination: e.target.checked})} className="w-5 h-5" /><span>Lamination (+5‚Ç¨/m¬≤)</span></label>
                                        </div>
                                        <div className="bg-gradient-to-r from-red-600 to-red-700 text-white rounded-lg p-6 mb-4">
                                            <div className="flex justify-between items-center mb-2"><span>Prix/m¬≤</span><span className="text-2xl font-black">{pricePerM2.toFixed(2)}‚Ç¨</span></div>
                                            <div className="flex justify-between items-center"><span className="text-lg">TOTAL TTC</span><span className="text-3xl font-black">{totalPrice.toFixed(2)}‚Ç¨</span></div>
                                        </div>
                                        <button onClick={addToCart} className="w-full btn-primary text-white py-4 rounded font-bold text-lg">Ajouter au panier</button>
                                    </div>
                                </div>
                            </div>
                            <div className="mt-12 bg-white rounded-lg p-8 border border-gray-200">
                                <h2 className="text-2xl font-bold text-gray-900 mb-4">Description</h2>
                                <p className="text-gray-700 leading-relaxed">{product.description_longue}</p>
                            </div>
                        </div>
                    </section>
                </div>
            );
        }
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
